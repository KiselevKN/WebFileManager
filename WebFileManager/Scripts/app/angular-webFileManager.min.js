(function(){"use strict";var n=angular.module("webFileManager",["ui.bootstrap","ngAnimate","ngFileUpload","toastr","wfmDirectives","pascalprecht.translate"]);n.config(function(n){angular.extend(n,{closeButton:!0,progressBar:!0})})})(),function(n){"use strict";n.constant("wfmConstants",{getIconsRoute:"/api/WebFileManager/Icons",getFolderRoute:"/api/WebFileManager/GetFolder",createFolderRoute:"/api/WebFileManager/CreateFolder",deleteFolderRoute:"/api/WebFileManager/DeleteFolder",deleteFoldersRoute:"/api/WebFileManager/DeleteFolders",renameFolderRoute:"/api/WebFileManager/RenameFolder",uploadFileRoute:"/api/WebFileManager/UploadFile",deleteFileRoute:"/api/WebFileManager/DeleteFile",deleteFilesRoute:"/api/WebFileManager/DeleteFiles",resizeFilesRoute:"/api/WebFileManager/ResizeImages",renameFileRoute:"/api/WebFileManager/RenameFile",templateSortingFilesRoute:"/Templates/SortingFiles",templateAddNewFolderRoute:"/Templates/AddNewFolder",templateResizeImageRoute:"/Templates/ResizeImage",templateDeleteSelectedRoute:"/Templates/DeleteSelected",templateDeleteFolderRoute:"/Templates/DeleteFolder",templateDeleteFileRoute:"/Templates/DeleteFile",templateRenameFolderRoute:"/Templates/RenameFolder",templateRenameFileRoute:"/Templates/RenameFile",templateWebFileManagerRoute:"/Templates/WebFileManager"})}(angular.module("webFileManager")),function(n){"use strict";n.config(["$translateProvider",function(n){n.translations("en",{SORT_NAME:"Name",SORT_DATE:"Date",SORT_TYPE:"Type",SORT_SIZE:"Size",NEW_FOLDER_NAME:"Folder Name ...",NEW_FILE_NAME:"File Name ...",ADD_NEW_FOLDER:"Add new folder",WIDTH:"W:",HEIGHT:"H:",MAX_WIDTH:"Max Width",MAX_HEIGHT:"Max Height",RESIZE_SELECTED_IMAGE:"Resize selected image",DELETE_SELECTED:"Delete Selected Folders And Files",DELETE_FOLDER:"Delete Folder",DELETE_FILE:"Delete File",CONF_DELETE_SELECTED:"Are you sure you want to delete the selected folders and files?",CONF_DELETE_FOLDER:"Are you sure you want to delete this folder?",CONF_DELETE_FILE:"Are you sure you want to delete this file?",RENAME_FOLDER:"Rename Folder",RENAME_FILE:"Rename File",CREATION_DATE:"Creation Date:",SIZE:"Size:",UPLOAD_FILES:"Upload files",SORTING:"Sorting",KB:" kB",ADD_A_FOLDER:"Adding Folder",TIMEOUT_EXPIRED:"Timeout expired!",DELETING_SELECTED_FOLDERS:"Deleting Selected Folders",DELETING_SELECTED_FILES:"Deleting Selected Files",DELETING_FOLDER:"Deleting Folder",DELETING_FILE:"Deleting File",RENAMING_FOLDER:"Renaming Folder",RENAMING_FILE:"Renaming File",RESIZING_IMAGES:"Resizing Images",UPLOADING_FILE:"Uploading File",INIT:"Initialization"});n.translations("ru",{SORT_NAME:"\u0418\u043c\u044f",SORT_DATE:"\u0414\u0430\u0442\u0430",SORT_TYPE:"\u0422\u0438\u043f",SORT_SIZE:"\u0420\u0430\u0437\u043c\u0435\u0440",NEW_FOLDER_NAME:"\u0418\u043c\u044f \u043f\u0430\u043f\u043a\u0438 ...",NEW_FILE_NAME:"\u0418\u043c\u044f \u0444\u0430\u0439\u043b\u0430 ...",ADD_NEW_FOLDER:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u0443\u044e \u043f\u0430\u043f\u043a\u0443",WIDTH:"\u0428:",HEIGHT:"\u0412:",MAX_WIDTH:"\u0428\u0438\u0440\u0438\u043d\u0430",MAX_HEIGHT:"\u0412\u044b\u0441\u043e\u0442\u0430",RESIZE_SELECTED_IMAGE:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u0432\u044b\u0431\u0440\u0430\u043d\u044b\u0445 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439",DELETE_SELECTED:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0438 \u0438 \u0444\u0430\u0439\u043b\u044b",DELETE_FOLDER:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u0430\u0442\u0430\u043b\u043e\u0433",DELETE_FILE:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0444\u0430\u0439\u043b",CONF_DELETE_SELECTED:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0438 \u0438 \u0444\u0430\u0439\u043b\u044b?",CONF_DELETE_FOLDER:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0439 \u043a\u0430\u0442\u0430\u043b\u043e\u0433?",CONF_DELETE_FILE:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0439 \u0444\u0430\u0439\u043b?",RENAME_FOLDER:"\u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u0442\u0430\u043b\u043e\u0433",RENAME_FILE:"\u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c \u0444\u0430\u0439\u043b",CREATION_DATE:"\u0414\u0430\u0442\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f:",SIZE:"\u0420\u0430\u0437\u043c\u0435\u0440:",UPLOAD_FILES:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u043e\u0432",SORTING:"\u0421\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c",KB:" \u043a\u0411",ADDING_A_FOLDER:"\u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u0430\u043f\u043a\u0438",TIMEOUT_EXPIRED:"\u0412\u0440\u0435\u043c\u044f \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u0438\u0441\u0442\u0435\u043a\u043b\u043e!",DELETING_SELECTED_FOLDERS:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0445 \u043f\u0430\u043f\u043e\u043a",DELETING_SELECTED_FILES:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0445 \u0444\u0430\u0439\u043b\u043e\u0432",DELETING_FOLDER:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430",DELETING_FILE:"\u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430",RENAMING_FOLDER:"\u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0430",RENAMING_FILE:"\u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0444\u0430\u0439\u043b\u0430",RESIZING_IMAGES:"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0440\u0430\u0437\u043c\u0435\u0440\u0430 \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0439",UPLOADING_FILE:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u0430 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440",INIT:"\u0418\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f"});n.useSanitizeValueStrategy(null);n.preferredLanguage("ru")}])}(angular.module("webFileManager")),function(n){"use strict";n.filter("toKiloByte",function(){return function(n){var t=n/1024;return t.toFixed(2).toString()}})}(angular.module("webFileManager")),function(n){"use strict";function t(){var r=function(n){var t=[];return angular.forEach(n.SubFolders,function(n){n.Selected==!0&&this.push(n.Name)},t),t},u=function(n){var t=[];return angular.forEach(n.Files,function(n){n.Selected==!0&&this.push(n.Name)},t),t},f=function(t){var i=[];return angular.forEach(t.Files,function(t){n(t.Name)&&t.Selected==!0&&this.push(t.Name)},i),i},e=function(n){var t=[];return angular.forEach(n.Files,function(n){n.Selected==!0&&this.push(n)},t),t},o=function(t){var i=[];return angular.forEach(t.Files,function(t){n(t.Name)&&t.Selected==!0&&this.push(t)},i),i},s=function(n){for(var t=0;t<n.SubFolders.length;++t)if(n.SubFolders[t].Selected===!0)return!0;return!1},h=function(n){for(var t=0;t<n.Files.length;++t)if(n.Files[t].Selected===!0)return!0;return!1},c=function(t){for(var i=0;i<t.Files.length;++i)if(n(t.Files[i].Name)&&t.Files[i].Selected===!0)return!0;return!1},t=function(n,i){for(var r=0;r<n.length;r++)if(n[r].extension===i)return n[r].base64;return t(n,"unknown")},n=function(n){return n.toLowerCase().match(/\.(jpg|jpeg|png|bmp|gif|ico)$/)?!0:!1},i=function(n){return n.substr(n.lastIndexOf(".")+1).toLowerCase()},l=function(r,u,f){var o,e,s;if(r.SubFolders!=null)for(o=0;o<r.SubFolders.length;o++)r.SubFolders[o].Icon=t(u,"folder"),r.SubFolders[o].Selected=!1,r.SubFolders[o].Type="folder",r.SubFolders[o].Size=0;if(r.Files!=null)for(e=0;e<r.Files.length;e++)n(r.Files[e].Name)&&f!="Small"||(r.Files[e].Icon=t(u,i(r.Files[e].Name))),r.Files[e].Selected=!1,r.Files[e].Type=i(r.Files[e].Name),s="\\".concat(r.Path).concat("\\"),s=s.concat(r.Files[e].Name),r.Files[e].Path=s.replace(/\\/g,"/")},a=function(n){for(var t=n.split("\\"),r=[],u=[],i=0;i<t.length;i++)u.push(t[i]),r.push({name:t[i],path:u.join("\\"),active:!1});return r[t.length-1].active=!0,r};return{getSelectedSubFolderNames:r,getSelectedFileNames:u,getSelectedImageNames:f,getSelectedFiles:e,getSelectedImages:o,anySubFoldersIsSelected:s,anyFilesIsSelected:h,anyImageIsSelected:c,correctFolder:l,getPathArray:a}}n.factory("wfmFolderService",t);t.$inject=[]}(angular.module("webFileManager")),function(n){"use strict";function t(n){var t=function(t,i){n.success(i,t)},i=function(t,i){n.error(i,t)};return{success:t,error:i}}n.factory("wfmNotificationService",t);t.$inject=["toastr"]}(angular.module("webFileManager")),function(n){"use strict";function t(n,t,i){var r=function(t,i,r,u){n({url:t,method:"POST",data:i,timeout:1e4}).then(function(n){r(n)}).catch(function(n){u(n)})},f=function(n,i,u){r(t.getIconsRoute,{Size:n},i,u)},e=function(n,i,u,f){r(t.getFolderRoute,{Path:n,Size:i},u,f)},o=function(n,i,u,f){r(t.createFolderRoute,{Path:n,Name:i},u,f)},s=function(n,i,u,f){r(t.deleteFolderRoute,{Path:n,Name:i},u,f)},h=function(n,i,u,f){r(t.deleteFoldersRoute,{Path:n,Names:i},u,f)},c=function(n,i,u,f,e){r(t.renameFolderRoute,{Path:n,OldName:i,NewName:u},f,e)},u=function(n,r,f,e,o){var h=t.uploadFileRoute.concat("?").concat("Path=").concat(n),s;r&&r.length&&(s=r.pop(),i.upload({url:h,data:{file:s}}).then(function(t){r.length<=0?f(t):e(t);u(n,r,f,e,o)},function(n){o(n)}))},l=function(n,i,u,f){r(t.deleteFileRoute,{Path:n,Name:i},u,f)},a=function(n,i,u,f){r(t.deleteFilesRoute,{Path:n,Names:i},u,f)},v=function(n,i,u,f,e,o){r(t.resizeFilesRoute,{Path:n,Names:i,Width:u,Height:f},e,o)},y=function(n,i,u,f,e){r(t.renameFileRoute,{Path:n,OldName:i,NewName:u},f,e)};return{getIcons:f,getFolder:e,createFolder:o,deleteFolder:s,deleteFolders:h,renameFolder:c,uploadFiles:u,deleteFile:l,deleteFiles:a,resizeFiles:v,renameFile:y}}n.factory("wfmHttpService",t);t.$inject=["$http","wfmConstants","Upload","$timeout"]}(angular.module("webFileManager")),function(n){"use strict";function t(n,t,i){var r=function(r,u,f){n.getIcons(r,function(n){u(n)},function(n){t.error(i.instant("INIT"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);f(n)})},u=function(r,u,f,e){n.getFolder(r,u,function(n){f(n)},function(n){t.error(i.instant("INIT"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);e(n)})},f=function(r,u,f,e){n.createFolder(r,u,function(n){t.success(i.instant("ADDING_A_FOLDER"),n.data);f(n)},function(n){t.error(i.instant("ADDING_A_FOLDER"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);e(n)})},e=function(r,u,f,e){n.deleteFolder(r,u,function(n){t.success(i.instant("DELETING_FOLDER"),n.data);f(n)},function(n){t.error(i.instant("DELETING_FOLDER"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);e(n)})},o=function(r,u,f,e){n.deleteFolders(r,u,function(n){t.success(i.instant("DELETING_SELECTED_FOLDERS"),n.data);f(n)},function(n){t.error(i.instant("DELETING_SELECTED_FOLDERS"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);e(n)})},s=function(r,u,f,e){n.deleteFiles(r,u,function(n){t.success(i.instant("DELETING_SELECTED_FILES"),n.data);f(n)},function(n){t.error(i.instant("DELETING_SELECTED_FILES"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);e(n)})},h=function(r,u,f,e,o){n.renameFolder(r,u,f,function(n){t.success(i.instant("RENAMING_FOLDER"),n.data);e(n)},function(n){t.error(i.instant("RENAMING_FOLDER"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);o(n)})},c=function(r,u,f,e){n.deleteFile(r,u,function(n){t.success(i.instant("DELETING_FILE"),n.data);f(n)},function(n){t.error(i.instant("DELETING_FILE"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);e(n)})},l=function(r,u,f,e,o){n.renameFile(r,u,f,function(n){t.success(i.instant("RENAMING_FILE"),n.data);e(n)},function(n){t.error(i.instant("RENAMING_FILE"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);o(n)})},a=function(r,u,f,e,o,s){n.resizeFiles(r,u,f,e,function(n){t.success(i.instant("RESIZING_IMAGES"),n.data);o(n)},function(n){t.error(i.instant("RESIZING_IMAGES"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);s(n)})},v=function(r,u,f,e,o){n.uploadFiles(r,u,function(n){t.success(i.instant("UPLOADING_FILE"),n.data);f(n)},function(n){t.success(i.instant("UPLOADING_FILE"),n.data);e(n)},function(n){t.error(i.instant("UPLOADING_FILE"),n.status==-1?i.instant("TIMEOUT_EXPIRED"):n.data.Message);o(n)})};return{getIcons:r,getFolder:u,createFolder:f,deleteFolder:e,deleteFolders:o,renameFolder:h,uploadFiles:v,deleteFile:c,deleteFiles:s,resizeFiles:a,renameFile:l}}n.factory("wfmHttpExService",t);t.$inject=["wfmHttpService","wfmNotificationService","$translate"]}(angular.module("webFileManager"));angular.module("wfmDirectives",[]).directive("bigSubfolder",function(){return{restrict:"E",templateUrl:"bigSubFolderTemplate.html"}}).directive("bigFile",function(){return{restrict:"E",templateUrl:"bigFileTemplate.html"}}).directive("medSubfolder",function(){return{restrict:"E",templateUrl:"medSubFolderTemplate.html"}}).directive("medFile",function(){return{restrict:"E",templateUrl:"medFileTemplate.html"}}).directive("smSubfolder",function(){return{restrict:"E",templateUrl:"smSubFolderTemplate.html"}}).directive("smFile",function(){return{restrict:"E",templateUrl:"smFileTemplate.html"}}).directive("fileManager",["$window","wfmConstants",function(n,t){return{restrict:"E",scope:{changeSelection:"&"},controller:["$scope","wfmHttpExService","wfmFolderService","wfmConstants",function(n,t,i,r){n.icons=[];n.folder={};n.pathArray=[""];n.progress=!1;n.deleteSelectedDisabled=!0;n.resizeSelectedImageDisabled=!0;n.size="Medium";n.selectedSize=n.size;n.getIcons=function(i){n.progress=!0;n.icons=[];t.getIcons(i,function(t){angular.forEach(t.data,function(n,t){this.push({extension:t,base64:n})},n.icons);n.getFolder("FileStorage",n.size)})};n.getFolder=function(r,u){n.progress=!0;t.getFolder(r,u,function(t){n.folder=t.data;i.correctFolder(n.folder,n.icons,n.size);n.pathArray=i.getPathArray(n.folder.Path);n.progress=!1;n.deleteSelectedDisable();n.selectedSize=n.size})};n.addNewFolder={templateUrl:r.templateAddNewFolderRoute,folderName:"",ok:function(i){n.progress=!0;t.createFolder(n.folder.Path,i,function(){n.getFolder(n.folder.Path,n.size)},function(){n.progress=!1});n.addNewFolder.folderName=""}};n.deleteFolder={templateUrl:r.templateDeleteFolderRoute,ok:function(i){n.progress=!0;t.deleteFolder(n.folder.Path,i,function(){n.getFolder(n.folder.Path,n.size)},function(){n.progress=!1})}};n.deleteSelected={templateUrl:r.templateDeleteSelectedRoute,ok:function(){n.progress=!0;var r=i.getSelectedSubFolderNames(n.folder),u=i.getSelectedFileNames(n.folder);r.length>0&&u.length>0?t.deleteFolders(n.folder.Path,r,function(){t.deleteFiles(n.folder.Path,u,function(){n.getFolder(n.folder.Path,n.size)},function(){n.progress=!1})},function(){n.progress=!1}):r.length>0&&u.length==0?t.deleteFolders(n.folder.Path,r,function(){n.getFolder(n.folder.Path,n.size)},function(){n.progress=!1}):r.length==0&&u.length>0&&t.deleteFiles(n.folder.Path,u,function(){n.getFolder(n.folder.Path,n.size)},function(){n.progress=!1})}};n.renameFolder={templateUrl:r.templateRenameFolderRoute,newFolderName:"",ok:function(i,r){n.progress=!0;t.renameFolder(n.folder.Path,i,r,function(){n.getFolder(n.folder.Path,n.size)},function(){n.progress=!1});n.renameFolder.newFolderName=""}};n.deleteFile={templateUrl:r.templateDeleteFileRoute,ok:function(i){n.progress=!0;t.deleteFile(n.folder.Path,i,function(){n.getFolder(n.folder.Path,n.size)},function(){n.progress=!1})}};n.renameFile={templateUrl:r.templateRenameFileRoute,newFileName:"",ok:function(i,r){n.progress=!0;t.renameFile(n.folder.Path,i,r,function(){n.getFolder(n.folder.Path,n.size)},function(){n.progress=!1});n.renameFile.newFileName=""}};n.resizeSelectedImage={templateUrl:r.templateResizeImageRoute,width:"",height:"",ok:function(r,u){n.progress=!0;var f=i.getSelectedImageNames(n.folder);t.resizeFiles(n.folder.Path,f,r,u,function(){n.getFolder(n.folder.Path,n.size)},function(){n.progress=!1})}};n.sortingFiles={templateUrl:r.templateSortingFilesRoute,filter:"Name",direction:"Asc",dir:!0,changeDir:function(t){n.sortingFiles.dir=t=="Asc"?!1:!0}};n.changeSize=function(){n.getIcons(n.size)};n.deleteSelectedDisable=function(){var t=i.anySubFoldersIsSelected(n.folder)||i.anyFilesIsSelected(n.folder);n.deleteSelectedDisabled=!t;n.resizeSelectedImageDisabled=!i.anyImageIsSelected(n.folder);n.changeSelection({files:i.getSelectedFiles(n.folder),images:i.getSelectedImages(n.folder)})};n.selectFolder=function(t){var i=n.folder.Path.concat("\\").concat(t);n.getFolder(i,n.size)};n.selectRootFolder=function(t){n.getFolder(t,n.size)};n.uploadFiles=function(i){i&&(n.progress=!0,t.uploadFiles(n.folder.Path,i,function(){n.getFolder(n.folder.Path,n.size)},function(){},function(){n.progress=!1}))};n.getIcons(n.size)}],link:function(t,i){t.onResize=function(){var n=$(".wfm").height(),t=$(".wfmMenu").height(),i=$(".wfmBreadcrumb").height();$(".wfmBody").height(n-t-i-2)};t.onResize();var r=angular.element(n);r.bind("resize",function(){t.onResize()});t.$watch(function(){return{width:i.parent().width(),height:i.parent().height()}},function(){t.onResize()},!0)},templateUrl:t.templateWebFileManagerRoute}}]);